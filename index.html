<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blair Ghost Tracker</title>
  <style>
    :root{
      --bg0:#07060f;
      --bg1:#0f0b1f;
      --card:rgba(255,255,255,.08);
      --card2:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.14);
      --text:#f6f1ff;
      --muted:rgba(246,241,255,.72);

      /* NEW THEME: pink + orange */
      --a:#ff3ea5;   /* pink */
      --b:#ff8a2b;   /* orange */
      --good:#44ffb4;
      --bad:#ff4d6d;
      --warn:#ffd166;

      --shadow: 0 20px 60px rgba(0,0,0,.55);
      --r:18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:
        radial-gradient(1100px 700px at 15% 10%, rgba(255,62,165,.25), transparent 55%),
        radial-gradient(900px 600px at 85% 15%, rgba(255,138,43,.23), transparent 55%),
        radial-gradient(900px 700px at 55% 85%, rgba(255,62,165,.14), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    .wrap{ max-width:1180px; margin:0 auto; padding:22px 16px 44px; }

    header{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between;
      margin-bottom:14px;
    }

    .title{
      display:flex; flex-direction:column; gap:6px;
    }
    h1{
      margin:0;
      font-size:34px;
      letter-spacing:.2px;
      line-height:1.08;
      text-shadow: 0 10px 40px rgba(0,0,0,.55);
    }
    .sub{ color:var(--muted); font-size:14px; }

    .topRight{
      display:flex; flex-direction:column; align-items:flex-end; gap:10px;
      min-width:300px;
    }

    .chipsRow{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .chip{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      color:rgba(255,255,255,.9);
      font-size:12px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 26px rgba(0,0,0,.25);
      white-space:nowrap;
    }
    .chip b{ color:white; }

    .grid{
      display:grid;
      grid-template-columns: 390px 1fr;
      gap:14px;
      align-items:start;
    }

    .panel{
      border:1px solid var(--stroke);
      border-radius: var(--r);
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
      position:relative;
    }
    .panel::before{
      content:"";
      position:absolute; inset:-2px;
      background: radial-gradient(600px 200px at 20% 0%, rgba(255,62,165,.20), transparent 60%),
                  radial-gradient(600px 200px at 80% 0%, rgba(255,138,43,.18), transparent 60%);
      pointer-events:none;
      opacity:.7;
    }

    .panelHeader{
      padding:14px 14px 12px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.10);
      position:relative;
    }
    .panelHeader h2{
      margin:0;
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(255,255,255,.78);
    }

    .btn{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.11), rgba(255,255,255,.05));
      color:rgba(255,255,255,.92);
      border-radius:999px;
      padding:8px 12px;
      font-size:12px;
      cursor:pointer;
      backdrop-filter: blur(10px);
      transition: transform .12s ease, border-color .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.25); }
    .btn:active{ transform: translateY(0px); }

    .content{ padding:14px; position:relative; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .muted{ color:var(--muted); font-size:12px; }
    .tiny{ font-size:11px; color:rgba(255,255,255,.68); }

    .sectionTitle{
      margin:12px 0 8px;
      font-size:12px;
      color:rgba(255,255,255,.85);
      display:flex; align-items:center; justify-content:space-between;
    }

    /* tri-state pills */
    .pill{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      padding:9px 10px;
      border-radius: 12px;
      font-size:12px;
      cursor:pointer;
      user-select:none;
      display:flex; align-items:center; gap:8px;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      min-height:36px;
    }
    .pill:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.26); }
    .dot{
      width:10px; height:10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.35);
      background: rgba(255,255,255,.08);
      flex:0 0 auto;
    }
    .pill[data-state="yes"]{
      border-color: rgba(68,255,180,.45);
      background: rgba(68,255,180,.10);
    }
    .pill[data-state="yes"] .dot{ background: var(--good); border-color: rgba(0,0,0,.18); }

    .pill[data-state="no"]{
      border-color: rgba(255,77,109,.45);
      background: rgba(255,77,109,.10);
    }
    .pill[data-state="no"] .dot{ background: var(--bad); border-color: rgba(0,0,0,.18); }

    .pill[data-state="maybe"]{
      border-color: rgba(255,209,102,.45);
      background: rgba(255,209,102,.10);
    }
    .pill[data-state="maybe"] .dot{ background: var(--warn); border-color: rgba(0,0,0,.18); }

    /* main right area */
    .rightTop{
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:14px;
    }

    .bigTitle{
      font-size:22px;
      margin:0 0 8px;
      letter-spacing:.2px;
    }
    .ghostName{
      font-size:30px;
      margin:0;
      line-height:1.05;
      letter-spacing:.3px;
    }

    .badgeRow{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .badge{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.16);
      padding:7px 10px;
      border-radius:999px;
      font-size:12px;
      color: rgba(255,255,255,.90);
    }

    .emptyState{
      padding:24px 14px;
      border:1px dashed rgba(255,255,255,.22);
      border-radius: 14px;
      background: rgba(255,255,255,.04);
      color: rgba(255,255,255,.78);
      line-height:1.35;
    }

    .meterBox{
      padding:14px;
    }
    .meterLabel{
      display:flex; align-items:flex-end; justify-content:space-between;
      margin-bottom:10px;
    }
    .meterLabel .cap{ font-size:12px; letter-spacing:.12em; text-transform:uppercase; color:rgba(255,255,255,.70); }
    .meterLabel .val{ font-size:22px; font-weight:800; }
    .bar{
      height:10px; border-radius:999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.12);
    }
    .fill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--a), var(--b));
      border-radius:999px;
      transition: width .22s ease;
    }
    .meterHint{
      margin-top:10px;
      color:rgba(255,255,255,.68);
      font-size:12px;
    }

    .list{
      margin-top:14px;
      border-top:1px solid rgba(255,255,255,.10);
    }
    .ghostRow{
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,.08);
      gap:14px;
    }
    .ghostRow:hover{ background: rgba(255,255,255,.03); }
    .leftInfo{ display:flex; flex-direction:column; gap:6px; min-width:0; }
    .gTitle{ margin:0; font-size:16px; }
    .gSub{ display:flex; gap:6px; flex-wrap:wrap; }
    .scoreBox{
      text-align:right;
      min-width:120px;
      color:rgba(255,255,255,.85);
      font-size:12px;
    }
    .scoreBox b{ display:block; font-size:16px; color:white; }

    /* forms */
    .controls{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .field{
      display:flex; flex-direction:column; gap:6px;
      min-width: 150px;
    }
    label{ font-size:11px; letter-spacing:.10em; text-transform:uppercase; color:rgba(255,255,255,.70); }
    select{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.92);
      outline:none;
    }
    /* FIX: dropdown options readable */
    select option{
      color:#111 !important;
      background:#fff !important;
    }

    .miniBtn{
      border-radius:12px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.07);
      color: rgba(255,255,255,.92);
      cursor:pointer;
    }
    .miniBtn:hover{ border-color: rgba(255,255,255,.28); }

    /* modal */
    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .modal{
      width:min(740px, 100%);
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(25,18,45,.92), rgba(12,10,20,.92));
      box-shadow: 0 30px 90px rgba(0,0,0,.75);
      overflow:hidden;
      position:relative;
    }
    .modalHeader{
      padding:14px 14px 12px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modalHeader h3{ margin:0; font-size:14px; letter-spacing:.08em; text-transform:uppercase; color:rgba(255,255,255,.78); }
    .modalBody{ padding:14px; color:rgba(255,255,255,.88); line-height:1.45; }
    .x{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color:white; border-radius:10px;
      padding:8px 10px; cursor:pointer;
    }

    .glowLine{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(255,62,165,.6), rgba(255,138,43,.6), transparent);
      opacity:.85;
    }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .rightTop{ grid-template-columns: 1fr; }
      .topRight{ align-items:flex-start; min-width:auto; }
      header{ flex-direction:column; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Blair Ghost Tracker</h1>
        <div class="sub">Tap what you saw. It ranks the most likely ghost even if you only have a little info.</div>
      </div>

      <div class="topRight">
        <div class="controls">
          <div class="field">
            <label>House / Map</label>
            <select id="mapSelect">
              <option>Any</option>
              <option>Farmhouse</option>
              <option>Juniper Street</option>
              <option>Mulburry Lane</option>
              <option>Roadhouse</option>
              <option>Stillhouse</option>
              <option>Abandoned House</option>
              <option>St. Mont's Chapel</option>
              <option>The Aldridge Hotel</option>
              <option>Campsite</option>
              <option>Orphanage</option>
              <option>School</option>
              <option>Dunwich Sanatorium</option>
            </select>
          </div>
          <div class="field">
            <label>Level</label>
            <select id="levelSelect">
              <option value="easy">Easy</option>
              <option value="medium">Medium</option>
              <option value="hard">Hard</option>
              <option value="nightmare">Nightmare</option>
            </select>
          </div>
          <button class="miniBtn" id="howBtn">How this works</button>
        </div>

        <div class="chipsRow" id="tipsRow"></div>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT -->
      <section class="panel">
        <div class="panelHeader">
          <h2>Your observations</h2>
          <button class="btn" id="resetBtn">Reset</button>
        </div>

        <div class="content">
          <div class="tiny">Tap once = <b>Yes</b>, tap twice = <b>No</b>, tap again = <b>Unknown</b></div>

          <div class="sectionTitle">
            <span>Evidence</span>
            <span class="tiny">Main evidence</span>
          </div>
          <div class="row" id="evidencePills"></div>

          <div class="sectionTitle" style="margin-top:14px;">
            <span>Quick clues</span>
            <span class="tiny">Stuff you notice fast</span>
          </div>
          <div class="row" id="cluePills"></div>

          <div class="sectionTitle" style="margin-top:14px;">
            <span>Haunted item spotted</span>
            <span class="tiny">Click what happened</span>
          </div>
          <div class="row" id="hauntedPills"></div>

          <div class="sectionTitle" style="margin-top:14px;">
            <span>Cursed objects + info</span>
            <span class="tiny">Tap to learn how it works</span>
          </div>

          <div class="row">
            <button class="pill" data-state="maybe" data-info="Music Box" id="co_music"><span class="dot"></span>Music Box</button>
            <button class="pill" data-state="maybe" data-info="Spirit Board" id="co_board"><span class="dot"></span>Spirit Board</button>
            <button class="pill" data-state="maybe" data-info="Summoning Circle" id="co_circle"><span class="dot"></span>Summoning Circle</button>
            <button class="pill" data-state="maybe" data-info="Tarot Cards" id="co_tarot"><span class="dot"></span>Tarot Cards</button>
          </div>

          <div style="margin-top:10px;" class="row">
            <div class="field" style="min-width:240px;">
              <label>Tarot card you pulled</label>
              <select id="tarotSelect">
                <option value="">None</option>
                <option>The Fool</option>
                <option>The Sun</option>
                <option>The Moon</option>
                <option>The Tower</option>
                <option>The Devil</option>
                <option>Death</option>
                <option>The Hermit</option>
                <option>The Wheel of Fortune</option>
                <option>The Chariot</option>
                <option>The Monstrosity</option>
              </select>
            </div>
            <button class="miniBtn" id="tarotExplain">Explain</button>
          </div>

        </div>
      </section>

      <!-- RIGHT -->
      <section class="panel">
        <div class="panelHeader">
          <h2>Results</h2>
          <div class="muted" id="pickedCount">0 picks</div>
        </div>

        <div class="content">
          <div class="rightTop">
            <div>
              <p class="bigTitle">Most likely</p>

              <div id="topSlot">
                <div class="emptyState">
                  Nothing selected yet.<br>
                  Start clicking evidence/clues and I’ll rank the ghosts.
                </div>
              </div>

              <div class="glowLine" style="margin:14px 0;"></div>
              <div id="ghostDetails"></div>
            </div>

            <div class="panel" style="box-shadow:none;">
              <div class="panelHeader">
                <h2>Confidence score</h2>
              </div>
              <div class="meterBox">
                <div class="meterLabel">
                  <div class="cap">Percent</div>
                  <div class="val" id="pctVal">0%</div>
                </div>
                <div class="bar"><div class="fill" id="pctFill"></div></div>
                <div class="meterHint">Higher = more matches, fewer contradictions</div>
              </div>
            </div>
          </div>

          <div class="list" id="rankList"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modalBack" id="modalBack">
    <div class="modal">
      <div class="modalHeader">
        <h3 id="modalTitle">Info</h3>
        <button class="x" id="modalClose">Close</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

<script>
/* -----------------------------
   DATA
------------------------------*/

const EVIDENCE = [
  "Freezing Temps",
  "EMF Level 5",
  "Ghost Orbs",
  "Spirit Box",
  "Ghost Writing",
  "Ultraviolet",
  "SLS Anomaly"
];

const CLUES = [
  "Stepped in salt",
  "Did NOT step in salt",
  "Parabolic: Banshee screech",
  "Parabolic: Demon roar (rare)",
  "Mimics equipment sounds",
  "Fake hunt ending / went silent",
  "Slow → FAST when it sees you",
  "Blind during hunts (movement-based)",
  "Hunts at high / any sanity",
  "Turns off lights a lot",
  "Turns ON lights (rare/odd)",
  "Low activity (quiet)",
  "High activity (constant)",
  "Turns on water",
  "Gets invisible near water",
  "UV prints show 4 fingers",
  "Targets only one player",
  "Moves room a lot (roamy)",
  "Moves to room with most items",
  "Items go missing",
  "Crucifix worked from far away",
  "Burnt crucifix happened"
];

const HAUNTED_ITEMS = [
  "Car alarm going off",
  "Phone/TV/radio interacts a lot",
  "Doors slam / closes doors",
  "Footsteps (heavy / clear)",
  "Lights flickered",
  "No breaker box / breaker weird",
  "Haunted object vibe (cursed item found)"
];

/* Ghost database (evidence is the reliable core; clues are “bonus weighting”) */
const GHOSTS = [
  {
    name:"Banshee",
    evidence:["EMF Level 5","Freezing Temps","SLS Anomaly"],
    cluesYes:["Parabolic: Banshee screech","Targets only one player"],
    cluesNo:[],
    desc:`Targets one player per match until they die. Can be identified by a unique Banshee screech on the Parabolic Microphone (chance increases the longer you hold it).`
  },
  {
    name:"Demon",
    evidence:["Freezing Temps","Ghost Writing","Spirit Box"],
    cluesYes:["Hunts at high / any sanity","Crucifix worked from far away","Burnt crucifix happened","Parabolic: Demon roar (rare)","High activity (constant)"],
    cluesNo:[],
    desc:`Very aggressive. Can hunt at very high sanity. Crucifix range works farther against Demon. Rare roar when a crucifix prevents a hunt. Gets faster after hunts.`
  },
  {
    name:"Faejkur",
    evidence:["EMF Level 5","Freezing Temps","Ghost Writing"],
    cluesYes:["Mimics equipment sounds"],
    cluesNo:["Parabolic: Banshee screech"],
    desc:`Mimics familiar equipment sounds (usually deeper). Can create fake footsteps during hunts.`
  },
  {
    name:"Harrow",
    evidence:["Ghost Orbs","Ghost Writing","SLS Anomaly"],
    cluesYes:["Stepped in salt"],
    cluesNo:["Moves room a lot (roamy)"],
    desc:`Never roams from its favorite room. Gets faster the closer it is to its room, slower farther away.`
  },
  {
    name:"Lament",
    evidence:["EMF Level 5","Ghost Orbs","Spirit Box"],
    cluesYes:["Fake hunt ending / went silent"],
    cluesNo:[],
    desc:`Can fake the end of a hunt (lights off + goes quiet, but faint footsteps may still exist). Does not speed up in line of sight.`
  },
  {
    name:"Mare",
    evidence:["Freezing Temps","Spirit Box","SLS Anomaly"],
    cluesYes:["Turns off lights a lot","High activity (constant)"],
    cluesNo:["Turns ON lights (rare/odd)"],
    desc:`Hates light. More dangerous in the dark, turns off lights often and can sometimes shatter lights.`
  },
  {
    name:"Nook",
    evidence:["EMF Level 5","Freezing Temps","Ghost Orbs"],
    cluesYes:["Moves to room with most items","Items go missing","Moves room a lot (roamy)"],
    cluesNo:[],
    desc:`Greedy item ghost. Likes rooms with lots of items, can relocate, and can make items vanish.`
  },
  {
    name:"Poltergeist",
    evidence:["Ultraviolet","Ghost Orbs","Spirit Box"],
    cluesYes:["High activity (constant)","Phone/TV/radio interacts a lot"],
    cluesNo:["Low activity (quiet)"],
    desc:`Super interactive with objects. Can throw multiple items (“poltsplosion”). Often interacts a lot, even during hunts.`
  },
  {
    name:"Revenant",
    evidence:["EMF Level 5","Ghost Writing","Ultraviolet"],
    cluesYes:["Slow → FAST when it sees you","Footsteps (heavy / clear)"],
    cluesNo:[],
    desc:`Very slow until it sees a player, then it becomes extremely fast. Great to identify by speed change.`
  },
  {
    name:"Shade",
    evidence:["EMF Level 5","Ghost Writing","SLS Anomaly"],
    cluesYes:["Low activity (quiet)"],
    cluesNo:["High activity (constant)"],
    desc:`Shy + inactive. Hunts are rarer. Needs low average sanity (~35%) to naturally hunt.`
  },
  {
    name:"Spirit",
    evidence:["Ghost Writing","Ultraviolet","Spirit Box"],
    cluesYes:[],
    cluesNo:[],
    desc:`Mostly “normal” behavior. Incense affects it longer than other ghosts.`
  },
  {
    name:"Strigoi",
    evidence:["EMF Level 5","Ultraviolet","Ghost Orbs"],
    cluesYes:["Turns on water","Gets invisible near water","UV prints show 4 fingers"],
    cluesNo:[],
    desc:`Water-focused. Can go invisible near running water. Turning off water can trigger a hunt chance. Sometimes has 4-finger UV prints.`
  },
  {
    name:"Vuult",
    evidence:["EMF Level 5","Ghost Orbs","SLS Anomaly"],
    cluesYes:["No breaker box / breaker weird","Lights flickered","High activity (constant)","Turns off lights a lot"],
    cluesNo:["Low activity (quiet)"],
    desc:`Electricity-based. Activity changes depending on “charge.” More electronics = more dangerous (can hunt at high sanity).`
  },
  {
    name:"Wraith",
    evidence:["Freezing Temps","Ghost Orbs","SLS Anomaly"],
    cluesYes:["Did NOT step in salt","Moves room a lot (roamy)"],
    cluesNo:["Stepped in salt"],
    desc:`Roamy and never steps in salt. Can (rarely) teleport to a player and cause an EMF 2 reading.`
  },
  {
    name:"Yama",
    evidence:["Ghost Writing","Spirit Box","SLS Anomaly"],
    cluesYes:["Moves room a lot (roamy)"],
    cluesNo:[],
    desc:`Very roamy and can change favorite room. Has a unique growly Spirit Box response.`
  },
  {
    name:"Yurei",
    evidence:["Freezing Temps","Ultraviolet","Spirit Box"],
    cluesYes:["Blind during hunts (movement-based)"],
    cluesNo:[],
    desc:`Blind-ish, but hears movement and electronics. Standing still with no electronics can sometimes save you.`
  },
  {
    name:"ZoZo",
    evidence:["EMF Level 5","Ultraviolet","Spirit Box"],
    cluesYes:["Hunts at high / any sanity","High activity (constant)"],
    cluesNo:["Low activity (quiet)"],
    desc:`Very dangerous and active. Can mess with Spirit Board responses (letters may turn red, repeats “ZoZo”).`
  },
  {
    name:"Krasue",
    evidence:["Freezing Temps","EMF Level 5","Ultraviolet"],
    cluesYes:["Hunts at high / any sanity"],
    cluesNo:[],
    desc:`Can sometimes change form. Terrified of fire—flames can slow it (especially in head form).`
  }
];

const INFO = {
  "Music Box": `A cursed item that can lure the ghost and start a cursed hunt. Costs sanity. It can break and trigger a cursed hunt. Activate with use (M1 on PC).`,
  "Spirit Board": `Lets you communicate at the cost of sanity. If you don’t “farewell” it can burn and trigger a cursed hunt. Activate with interact (E on PC).`,
  "Summoning Circle": `Light it with a lighter to force a manifestation and start a cursed hunt. Costs sanity. You can relight it later.`,
  "Tarot Cards": `10 cards per deck. Each card burns after use. It can help or ruin your run depending on the pull.`
};

const TAROT = {
  "The Fool": "Usually does nothing / can fake you out.",
  "The Sun": "Good effect (often sanity boost).",
  "The Moon": "Bad/chaos effect (often sanity loss).",
  "The Tower": "Starts a cursed hunt / dangerous effect.",
  "The Devil": "Negative effect (varies).",
  "Death": "Very dangerous outcome.",
  "The Hermit": "Can calm/stop the ghost temporarily (varies).",
  "The Wheel of Fortune": "Random good or bad.",
  "The Chariot": "Speed-related effect (varies).",
  "The Monstrosity": "Triggers intense scary effects (varies)."
};

const TOP_TIPS = [
  "Tip: Salt footprints = No → Wraith",
  "Tip: Parabolic screech = Yes → Banshee",
  "Tip: Fast only when it sees you → Revenant",
  "Tip: Mimic sounds (deeper) → Faejkur",
  "Tip: Water + invisible → Strigoi",
  "Tip: Super low activity → Shade"
];

/* -----------------------------
   STATE
------------------------------*/
const state = {
  picks: new Map(),  // key -> "unknown" | "yes" | "no" | "maybe"(used for info buttons only)
  haunted: new Set(), // haunted items selected
};

const levelWeights = {
  easy:   { ev: 10, clue: 4, haunted: 3, contradiction: 14 },
  medium: { ev: 9,  clue: 5, haunted: 4, contradiction: 13 },
  hard:   { ev: 8,  clue: 6, haunted: 5, contradiction: 12 },
  nightmare:{ ev: 7, clue: 7, haunted: 6, contradiction: 11 },
};

/* -----------------------------
   UI BUILD
------------------------------*/
const evidencePills = document.getElementById("evidencePills");
const cluePills = document.getElementById("cluePills");
const hauntedPills = document.getElementById("hauntedPills");
const rankList = document.getElementById("rankList");
const topSlot = document.getElementById("topSlot");
const ghostDetails = document.getElementById("ghostDetails");

const pctVal = document.getElementById("pctVal");
const pctFill = document.getElementById("pctFill");
const pickedCount = document.getElementById("pickedCount");

const tipsRow = document.getElementById("tipsRow");
TOP_TIPS.forEach(t=>{
  const el=document.createElement("div");
  el.className="chip";
  el.textContent=t;
  tipsRow.appendChild(el);
});

function makeTriPill(label, group){
  const b=document.createElement("button");
  b.className="pill";
  b.setAttribute("data-state","unknown");
  b.setAttribute("data-key", group + ":" + label);
  b.innerHTML=`<span class="dot"></span>${label}`;
  b.addEventListener("click", ()=>cyclePill(b));
  return b;
}

function makeHauntedPill(label){
  const b=document.createElement("button");
  b.className="pill";
  b.setAttribute("data-state","unknown");
  b.setAttribute("data-key","haunted:"+label);
  b.innerHTML=`<span class="dot"></span>${label}`;
  b.addEventListener("click", ()=>{
    // Haunted items are simple toggle: Unknown -> Yes -> Unknown
    const cur=b.getAttribute("data-state");
    const next = (cur==="yes") ? "unknown" : "yes";
    b.setAttribute("data-state", next);
    if(next==="yes") state.haunted.add(label); else state.haunted.delete(label);
    render();
  });
  return b;
}

EVIDENCE.forEach(e=> evidencePills.appendChild(makeTriPill(e, "ev")));
CLUES.forEach(c=> cluePills.appendChild(makeTriPill(c, "clue")));
HAUNTED_ITEMS.forEach(h=> hauntedPills.appendChild(makeHauntedPill(h)));

function cyclePill(btn){
  const key = btn.getAttribute("data-key");
  const cur = btn.getAttribute("data-state");
  const next = (cur==="unknown") ? "yes" : (cur==="yes") ? "no" : "unknown";
  btn.setAttribute("data-state", next);
  state.picks.set(key, next);
  render();
}

/* info modal */
const modalBack = document.getElementById("modalBack");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");
document.getElementById("modalClose").onclick = ()=> modalBack.style.display="none";
modalBack.addEventListener("click",(e)=>{ if(e.target===modalBack) modalBack.style.display="none"; });

function openModal(title, html){
  modalTitle.textContent = title;
  modalBody.innerHTML = html;
  modalBack.style.display="flex";
}

/* cursed object buttons = info only */
["co_music","co_board","co_circle","co_tarot"].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener("click", ()=>{
    const name = el.getAttribute("data-info");
    openModal(name, `<div>${INFO[name] || "No info yet."}</div>`);
  });
});

document.getElementById("tarotExplain").addEventListener("click", ()=>{
  const v = document.getElementById("tarotSelect").value;
  if(!v) return openModal("Tarot Cards", "Pick a card from the dropdown first.");
  openModal("Tarot: " + v, `<div>${TAROT[v] || "No description added yet."}</div>`);
});

document.getElementById("howBtn").addEventListener("click", ()=>{
  openModal("How this works", `
    <div style="display:flex;flex-direction:column;gap:10px;">
      <div><b>Evidence</b> is weighted the strongest.</div>
      <div><b>Quick clues</b> and <b>haunted items</b> help when you don’t have full evidence.</div>
      <div>If you mark something <b>No</b> and a ghost requires it, that ghost gets a big penalty.</div>
      <div>Hard/Nightmare makes clues matter more (because evidence can be annoying to get).</div>
    </div>
  `);
});

document.getElementById("resetBtn").addEventListener("click", ()=>{
  state.picks.clear();
  state.haunted.clear();
  document.querySelectorAll(".pill[data-key]").forEach(p=> p.setAttribute("data-state","unknown"));
  document.getElementById("tarotSelect").value="";
  render();
});

/* -----------------------------
   SCORING
------------------------------*/
function getLevelWeight(){
  const lvl = document.getElementById("levelSelect").value || "easy";
  return levelWeights[lvl] || levelWeights.easy;
}

function readTriState(group, label){
  const key = group + ":" + label;
  return state.picks.get(key) || "unknown";
}

function hasAnySelection(){
  // evidence/clue or haunted selected
  if(state.haunted.size>0) return true;
  for(const v of state.picks.values()){
    if(v==="yes" || v==="no") return true;
  }
  return false;
}

function scoreGhost(g){
  const w = getLevelWeight();

  let score = 0;
  let maxPossible = 0;
  let conflicts = 0;

  // Evidence
  for(const ev of EVIDENCE){
    const s = readTriState("ev", ev);
    if(s==="unknown") continue;

    maxPossible += w.ev;
    const has = g.evidence.includes(ev);
    if(s==="yes"){
      if(has) score += w.ev;
      else { score -= w.contradiction; conflicts++; }
    }else if(s==="no"){
      if(has) { score -= w.contradiction; conflicts++; }
      else score += Math.round(w.ev * 0.35);
    }
  }

  // Clues
  for(const c of CLUES){
    const s = readTriState("clue", c);
    if(s==="unknown") continue;

    maxPossible += w.clue;
    const yesList = g.cluesYes || [];
    const noList  = g.cluesNo || [];

    if(s==="yes"){
      if(yesList.includes(c)) score += w.clue;
      else if(noList.includes(c)) { score -= w.contradiction; conflicts++; }
      else score += Math.round(w.clue * 0.15);
    }else if(s==="no"){
      if(yesList.includes(c)) { score -= Math.round(w.clue * 1.5); conflicts++; }
      else score += Math.round(w.clue * 0.15);
    }
  }

  // Haunted items (simple boosts; also helps Vuult / Polter etc with “electric” type moments)
  if(state.haunted.size){
    for(const h of state.haunted){
      maxPossible += w.haunted;

      // lightweight mapping
      if(h==="Car alarm going off"){
        if(g.name==="Poltergeist") score += w.haunted;
        else score += Math.round(w.haunted * 0.15);
      }
      else if(h==="Phone/TV/radio interacts a lot"){
        if(g.name==="Poltergeist") score += w.haunted;
        else score += Math.round(w.haunted * 0.10);
      }
      else if(h==="Doors slam / closes doors"){
        score += Math.round(w.haunted * 0.20);
      }
      else if(h==="Lights flickered"){
        if(g.name==="Vuult" || g.name==="Mare") score += w.haunted;
        else score += Math.round(w.haunted * 0.12);
      }
      else if(h==="No breaker box / breaker weird"){
        if(g.name==="Vuult") score += w.haunted;
        else score += Math.round(w.haunted * 0.08);
      }
      else if(h==="Footsteps (heavy / clear)"){
        if(g.name==="Revenant") score += w.haunted;
        else score += Math.round(w.haunted * 0.10);
      }
      else if(h==="Haunted object vibe (cursed item found)"){
        score += Math.round(w.haunted * 0.15);
      }
    }
  }

  // Normalize to 0..100-ish for display
  // Allow negative score, but percent clamps to 0..100
  const raw = score;
  const denom = Math.max(1, maxPossible);
  let pct = Math.round((raw / denom) * 100);
  pct = Math.max(0, Math.min(100, pct));

  return { score: raw, pct, conflicts };
}

function formatEvidenceBadges(arr){
  return arr.map(x=>`<span class="badge">${x}</span>`).join("");
}

/* -----------------------------
   RENDER
------------------------------*/
function render(){
  // count picks
  let picks=0;
  for(const v of state.picks.values()){
    if(v==="yes" || v==="no") picks++;
  }
  picks += state.haunted.size;
  pickedCount.textContent = `${picks} pick${picks===1?"":"s"}`;

  // compute + sort
  const ranked = GHOSTS.map(g=>{
    const s = scoreGhost(g);
    return { ...g, ...s };
  }).sort((a,b)=> b.pct - a.pct || b.score - a.score);

  // top area
  if(!hasAnySelection()){
    topSlot.innerHTML = `
      <div class="emptyState">
        Nothing selected yet.<br>
        Start clicking evidence/clues and I’ll rank the ghosts.
      </div>`;
    ghostDetails.innerHTML = "";
    pctVal.textContent = "0%";
    pctFill.style.width = "0%";
  }else{
    const top = ranked[0];
    topSlot.innerHTML = `
      <div>
        <h3 class="ghostName">${top.name}</h3>
        <div class="badgeRow">${formatEvidenceBadges(top.evidence)}</div>
        <div style="margin-top:10px;" class="muted">Based on what you selected so far.</div>
      </div>
    `;

    pctVal.textContent = `${top.pct}%`;
    pctFill.style.width = `${top.pct}%`;

    ghostDetails.innerHTML = `
      <div class="panel" style="margin-top:14px; box-shadow:none;">
        <div class="panelHeader"><h2>Ghost description</h2></div>
        <div class="content" style="padding-top:12px;">
          <div style="color:rgba(255,255,255,.88); line-height:1.45;">
            ${top.desc}
          </div>
          <div style="margin-top:12px;" class="sectionTitle">
            <span>Quick double-check</span>
            <span class="tiny">What matches</span>
          </div>
          <div class="row">
            ${(top.cluesYes||[]).slice(0,10).map(c=>`<span class="badge">✅ ${c}</span>`).join("")}
          </div>
        </div>
      </div>
    `;
  }

  // list
  rankList.innerHTML = ranked.map(g=>{
    const tags = g.evidence.slice(0,3).map(x=>`<span class="badge">${x}</span>`).join("");
    return `
      <div class="ghostRow">
        <div class="leftInfo">
          <p class="gTitle">${g.name}</p>
          <div class="gSub">${tags}</div>
          <div class="tiny" style="margin-top:4px;">${g.desc}</div>
        </div>
        <div class="scoreBox">
          <b>${g.pct}%</b>
          ${g.conflicts ? `<span style="color:rgba(255,77,109,.9)">conflicts: ${g.conflicts}</span>` : `<span class="tiny">no conflicts</span>`}
        </div>
      </div>
    `;
  }).join("");
}

render();
</script>
</body>
</html>
