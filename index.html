<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blair Ghost Helper</title>
  <style>
    :root{
      --bg0:#0b0620;
      --bg1:#12083a;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --text:#f6f3ff;
      --muted: rgba(246,243,255,.72);
      --muted2: rgba(246,243,255,.55);
      --hot1:#ff4fd8; /* pink */
      --hot2:#ff9a3d; /* orange */
      --good:#57ffb3;
      --bad:#ff5e6a;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --round: 18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 600px at 15% 10%, rgba(255,79,216,.18), transparent 55%),
        radial-gradient(900px 500px at 90% 15%, rgba(255,154,61,.16), transparent 55%),
        radial-gradient(900px 700px at 55% 95%, rgba(120,70,255,.12), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      min-height:100vh;
    }

    .wrap{max-width:1200px;margin:0 auto;padding:22px 16px 60px}
    header{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between;
      margin-bottom:14px;
    }
    .title{
      display:flex; flex-direction:column; gap:6px;
    }
    h1{
      margin:0;
      font-size:34px;
      letter-spacing:.2px;
      line-height:1.05;
    }
    .sub{
      color:var(--muted);
      font-size:14px;
      line-height:1.35;
      max-width:620px;
    }

    .topbar{
      display:flex; flex-wrap:wrap; gap:10px; justify-content:flex-end; align-items:center;
    }
    .chip{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 22px rgba(0,0,0,.18);
      display:flex; gap:8px; align-items:center;
      max-width: 340px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .chip b{color:var(--text); font-weight:700}
    .glowdot{
      width:9px;height:9px;border-radius:50%;
      background: linear-gradient(135deg, var(--hot1), var(--hot2));
      box-shadow: 0 0 16px rgba(255,79,216,.45);
      flex: 0 0 auto;
    }

    .grid{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:14px;
      align-items:start;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius: var(--round);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .cardHeader{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 14px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: linear-gradient(90deg, rgba(255,79,216,.10), rgba(255,154,61,.08));
    }
    .cardHeader .left{
      display:flex; flex-direction:column; gap:2px;
    }
    .cardHeader .kicker{
      font-size:12px;
      color:var(--muted);
      letter-spacing:.5px;
      text-transform:uppercase;
    }
    .cardHeader .name{
      font-size:14px;
      font-weight:800;
      letter-spacing:.2px;
    }

    .btn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      font-size:12px;
      cursor:pointer;
      transition: transform .05s ease, border-color .2s ease, background .2s ease;
      backdrop-filter: blur(8px);
    }
    .btn:hover{border-color: rgba(255,255,255,.28)}
    .btn:active{transform: translateY(1px)}
    .btn.hot{
      border-color: rgba(255,79,216,.42);
      background: linear-gradient(135deg, rgba(255,79,216,.18), rgba(255,154,61,.16));
    }

    .bodyPad{padding:14px}
    .sectionTitle{
      display:flex; align-items:center; justify-content:space-between;
      margin:10px 0 8px;
    }
    .sectionTitle h3{
      margin:0;
      font-size:13px;
      letter-spacing:.3px;
      text-transform:uppercase;
      color:var(--muted);
    }
    .hint{
      font-size:12px;
      color:var(--muted2);
    }

    .pillGrid{
      display:flex; flex-wrap:wrap; gap:8px;
    }

    .pill{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color:var(--text);
      border-radius:999px;
      padding:10px 12px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      transition: border-color .2s ease, background .2s ease, transform .05s ease;
      display:inline-flex;
      gap:8px;
      align-items:center;
      max-width: 100%;
    }
    .pill:active{transform: translateY(1px)}
    .dot{
      width:10px;height:10px;border-radius:50%;
      border:1px solid rgba(255,255,255,.30);
      background: rgba(0,0,0,.25);
      box-shadow:none;
    }
    .pill[data-state="unknown"] .dot{
      background: rgba(0,0,0,.25);
      border-color: rgba(255,255,255,.28);
    }
    .pill[data-state="yes"]{
      border-color: rgba(87,255,179,.55);
      background: rgba(87,255,179,.10);
    }
    .pill[data-state="yes"] .dot{
      background: rgba(87,255,179,.90);
      border-color: rgba(87,255,179,.85);
      box-shadow: 0 0 18px rgba(87,255,179,.22);
    }
    .pill[data-state="no"]{
      border-color: rgba(255,94,106,.55);
      background: rgba(255,94,106,.10);
    }
    .pill[data-state="no"] .dot{
      background: rgba(255,94,106,.92);
      border-color: rgba(255,94,106,.85);
      box-shadow: 0 0 18px rgba(255,94,106,.20);
    }

    .row{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }

    .select{
      width:100%;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      color: var(--text);
      padding:10px 12px;
      border-radius: 12px;
      font-size:13px;
      outline:none;
    }

    /* IMPORTANT: make dropdown options readable */
    select option{
      background: #ffffff;
      color:#111111;
    }

    .miniActions{
      display:flex; gap:10px; align-items:center;
    }

    .explainBox{
      margin-top:10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      border-radius: 14px;
      padding:12px;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
      display:none;
    }
    .explainBox.show{display:block}
    .explainBox b{color:var(--text)}

    /* Right column */
    .rightTop{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:14px;
      margin-bottom:14px;
    }

    .bigTitle{
      font-size:24px;
      margin:2px 0 6px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .emptyState{
      color: var(--muted);
      font-size:14px;
      line-height:1.45;
      padding:8px 0 0;
    }

    .tags{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:8px;
    }
    .tag{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      color: var(--muted);
    }
    .tag strong{color:var(--text)}

    .meterWrap{
      padding:14px;
    }
    .meterLabel{
      display:flex; align-items:center; justify-content:space-between;
      color:var(--muted);
      font-size:12px;
      letter-spacing:.4px;
      text-transform:uppercase;
      margin-bottom:8px;
    }
    .bar{
      height:12px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.12);
      overflow:hidden;
      position:relative;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--hot1), var(--hot2));
      box-shadow: 0 0 22px rgba(255,79,216,.25);
      border-radius:999px;
      transition: width .25s ease;
    }
    .meterHint{
      margin-top:8px;
      color:var(--muted2);
      font-size:12px;
      line-height:1.35;
    }

    .list{
      padding:10px 14px 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .ghostRow{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      border-radius: 14px;
      padding:12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .ghostRow .left{
      min-width:0;
      flex:1;
    }
    .ghostRow .gname{
      margin:0;
      font-weight:900;
      font-size:16px;
      letter-spacing:.2px;
    }
    .ghostRow .small{
      color: var(--muted2);
      font-size:12px;
      margin-top:4px;
      line-height:1.3;
    }
    .ghostRow .miniTags{
      margin-top:8px;
      display:flex; flex-wrap:wrap; gap:6px;
    }
    .miniTag{
      font-size:11px;
      padding:6px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--muted);
    }
    .scoreBox{
      text-align:right;
      flex:0 0 auto;
      min-width:74px;
    }
    .scoreBox .pct{
      font-weight:900;
      font-size:16px;
    }
    .scoreBox .conf{
      color: var(--muted2);
      font-size:11px;
      margin-top:4px;
    }

    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
      .rightTop{grid-template-columns: 1fr}
      header{flex-direction:column; align-items:flex-start}
      .topbar{justify-content:flex-start}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Blair Ghost Helper</h1>
        <div class="sub">
          Tap what you notice. It doesn’t need “perfect evidence” — it ranks the most likely ghost based on whatever you’ve got.
        </div>
      </div>

      <div class="topbar" id="tipsBar">
        <div class="chip"><span class="glowdot"></span><span><b>Tip:</b> Stepped in salt → likely <b>NOT</b> Wraith</span></div>
        <div class="chip"><span class="glowdot"></span><span><b>Tip:</b> Banshee screech on Parabolic → <b>Banshee</b></span></div>
        <div class="chip"><span class="glowdot"></span><span><b>Tip:</b> Water on + invisible blinks → <b>Strigoi</b></span></div>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: observations -->
      <div class="card">
        <div class="cardHeader">
          <div class="left">
            <div class="kicker">Your Run</div>
            <div class="name">Observations</div>
          </div>
          <button class="btn hot" id="resetBtn">Reset</button>
        </div>

        <div class="bodyPad">
          <div class="row" style="margin-bottom:8px">
            <div style="flex:1">
              <label class="hint" style="display:block;margin-bottom:6px">House / Map</label>
              <select class="select" id="houseSelect"></select>
            </div>
            <div style="width:170px">
              <label class="hint" style="display:block;margin-bottom:6px">Difficulty</label>
              <select class="select" id="difficultySelect"></select>
            </div>
          </div>

          <div class="sectionTitle">
            <h3>Evidence</h3>
            <div class="hint">Tap = Yes → No → Unknown</div>
          </div>
          <div class="pillGrid" id="evidenceGrid"></div>

          <div class="sectionTitle" style="margin-top:16px">
            <h3>What happened</h3>
            <div class="hint">Same tap cycle</div>
          </div>
          <div class="pillGrid" id="clueGrid"></div>

          <div class="sectionTitle" style="margin-top:16px">
            <h3>Cursed objects / haunted items</h3>
            <div class="hint">Pick what you found + hit Explain</div>
          </div>

          <div class="row">
            <div style="flex:1">
              <select class="select" id="cursedSelect"></select>
            </div>
            <div class="miniActions">
              <button class="btn" id="cursedExplainBtn">Explain</button>
            </div>
          </div>
          <div class="explainBox" id="cursedExplainBox"></div>

          <div class="sectionTitle" style="margin-top:14px">
            <h3>Tarot cards</h3>
            <div class="hint">Optional</div>
          </div>
          <div class="row">
            <div style="flex:1">
              <select class="select" id="tarotSelect"></select>
            </div>
            <div class="miniActions">
              <button class="btn" id="tarotExplainBtn">Explain</button>
            </div>
          </div>
          <div class="explainBox" id="tarotExplainBox"></div>
        </div>
      </div>

      <!-- RIGHT: results -->
      <div>
        <div class="rightTop">
          <div class="card">
            <div class="cardHeader">
              <div class="left">
                <div class="kicker">Most likely</div>
                <div class="name">Best match</div>
              </div>
              <button class="btn" id="copyBtn">Copy Share Link</button>
            </div>
            <div class="bodyPad" id="topPickArea">
              <div class="emptyState" id="emptyTop">
                Pick any evidence or “what happened” clue and the most likely ghost will show up here.
              </div>
              <div id="topPick" style="display:none">
                <div class="bigTitle" id="topName"></div>
                <div class="tags" id="topEvidenceTags"></div>
                <div class="explainBox show" id="topDescBox" style="display:block;margin-top:12px"></div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="cardHeader">
              <div class="left">
                <div class="kicker">Confidence</div>
                <div class="name">Score</div>
              </div>
            </div>
            <div class="meterWrap">
              <div class="meterLabel">
                <span>Confidence</span>
                <span id="confidencePct">0%</span>
              </div>
              <div class="bar"><div id="confidenceBar"></div></div>
              <div class="meterHint" id="confidenceHint">
                Starts at 0%. It rises when your picks match a ghost’s evidence/behavior, and drops with contradictions.
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardHeader">
            <div class="left">
              <div class="kicker">Ranked list</div>
              <div class="name">Top matches</div>
            </div>
            <span class="hint" id="countHint">—</span>
          </div>
          <div class="list" id="rankList"></div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ----------------------------
   DATABASE (easy to edit later)
---------------------------- */

const HOUSES = [
  "Farmhouse","Finjito's","Juniper Street","Mulburry Lane","Roadhouse","Stillhouse",
  "Abandoned House","St. Mont's Chapel",
  "The Aldridge Hotel","Campsite","Orphanage","School","Dunwich Sanatorium"
];

const DIFFICULTIES = [
  { id:"easy", name:"Easy",   weights:{ evidence: 6, clue: 3, contradiction: 7 } },
  { id:"medium", name:"Medium", weights:{ evidence: 6, clue: 4, contradiction: 7 } },
  { id:"hard", name:"Hard",   weights:{ evidence: 5, clue: 5, contradiction: 8 } },
  { id:"nightmare", name:"Nightmare", weights:{ evidence: 4, clue: 6, contradiction: 9 } }
];

// Evidence list (clean, simple)
const EVIDENCE = [
  "EMF Level 5",
  "Freezing Temps",
  "Ghost Writing",
  "Ultraviolet",
  "Ghost Orbs",
  "Spirit Box",
  "SLS Anomaly"
];

// Your simplified “what happened” list
const CLUES = [
  "Stepped in salt",
  "Blew out candles",
  "Broke lights",
  "Saw ghost when at high sanity",
  "Low temp room",

  "Heard parabolic: Banshee screech",
  "Heard parabolic: Demon roar (rare)",
  "Mimics equipment sounds",
  "Fake hunt ending / went silent",
  "Fast when it sees you",
  "Blind during hunts (movement-based)",
  "Hunts at high sanity",
  "Turns off lights a lot",
  "Turns on lights",
  "Low activity",
  "High activity",
  "Turns on water",
  "Gets invisible near water",
  "UV shows 4 fingers",
  "Targets only one player",
  "Moves room a lot",
  "Moves to room with most items",
  "Items go missing",
  "Burnt crucifix",
  "Crucifix worked from far away",
  "Closes doors",
  "Car alarm went off"
];

// Cursed objects / haunted items
const CURSED_OBJECTS = [
  { id:"none", name:"None", desc:"No cursed object / haunted item found (or you haven’t seen it yet)." },
  { id:"music_box", name:"Music Box", desc:"Plays a tune and drains sanity. After a bit it breaks and triggers a cursed hunt. Can also lure the ghost during a hunt (the ghost locks onto where the box was held last)." },
  { id:"spirit_board", name:"Spirit Board", desc:"Lets you ask questions at the cost of sanity. If you don’t properly end it (saying goodbye), it burns and can start a cursed hunt." },
  { id:"summoning_circle", name:"Summoning Circle", desc:"Light it with a lighter to forcibly manifest the ghost and trigger a cursed hunt (costs a ton of sanity)." },
  { id:"tarot_cards", name:"Tarot Cards (Deck)", desc:"A deck of 10 cards. Each draw burns the card and gives a positive or negative effect to you/your team." }
];

// Tarot cards list (simple “helper mode” descriptions)
const TAROT = [
  { id:"none", name:"None", desc:"No tarot card used / pulled." },
  { id:"fool", name:"The Fool", desc:"Usually a ‘nothing happens / fake-out’ type card. You basically wasted a draw." },
  { id:"death", name:"Death", desc:"Triggers a dangerous moment — often leads into a hunt / chaos. Be ready to hide." },
  { id:"tower", name:"The Tower", desc:"Major negative effect. Expect something disruptive (hunts/events/aggro spike)." },
  { id:"sun", name:"The Sun", desc:"Positive effect. Often helps the team (sanity / safety / breathing room)." },
  { id:"moon", name:"The Moon", desc:"Negative effect, often sanity-related. Makes things riskier." },
  { id:"wheel", name:"Wheel of Fortune", desc:"Could be good or bad. It’s literally a gamble." },
  { id:"devil", name:"The Devil", desc:"A scary/danger card — treat like ‘brace for trouble’." },
  { id:"chariot", name:"The Chariot", desc:"Movement/escape type effect. Fun card, can save you." },
  { id:"hermit", name:"The Hermit", desc:"Pauses/contains the ghost temporarily (a breather card)." },
  { id:"monstrosity", name:"Monstrosity", desc:"Forces a nasty event/manifestation vibe. Usually bad." }
];

// Ghost database (18 ghosts — includes Krasue)
const GHOSTS = [
  {
    name:"Banshee",
    evidence:["EMF Level 5","Freezing Temps","SLS Anomaly"],
    cluesYes:["Heard parabolic: Banshee screech","Targets only one player","Saw ghost when at high sanity"],
    desc:"Banshees lock onto one target. If the target is inside, it ignores everyone else. If you hear the unique Banshee screech on the Parabolic Microphone, that’s basically a dead giveaway.",
    tips:["Try Parabolic in/near ghost room.","Watch if it tunnels one player only.","Don’t confuse line-of-sight pathing with ‘targeting’."]
  },
  {
    name:"Demon",
    evidence:["Freezing Temps","Ghost Writing","Spirit Box"],
    cluesYes:["Hunts at high sanity","High activity","Burnt crucifix","Crucifix worked from far away"],
    cluesMaybe:["Heard parabolic: Demon roar (rare)"],
    desc:"Demons are aggressively hunt-happy and can hunt at high sanity. Crucifixes work from farther away than normal against them.",
    tips:["If it hunts super early, respect it.","Place crucifix early.","If crucifix range feels huge → Demon vibe."]
  },
  {
    name:"Faejkur",
    evidence:["EMF Level 5","Freezing Temps","Ghost Writing"],
    cluesYes:["Mimics equipment sounds","High activity"],
    desc:"Faejkur mimics equipment noises to confuse you (not footsteps, not banshee scream). If you keep hearing ‘fake’ tool sounds, it might be this.",
    tips:["Listen for weird ‘off’ copies of sounds.","Try EMF/Tools nearby to bait mimic."]
  },
  {
    name:"Harrow",
    evidence:["Ghost Writing","Ghost Orbs","SLS Anomaly"],
    cluesYes:["Fast when it sees you"],
    desc:"Harrow is super territorial and tied to its favorite room. During hunts it tends to be faster when close to its room and slower farther away.",
    tips:["Pay attention to footstep speed changes.","If it feels ‘room-anchored’, think Harrow."]
  },
  {
    name:"Lament",
    evidence:["EMF Level 5","Ghost Orbs","Spirit Box"],
    cluesYes:["Fake hunt ending / went silent"],
    desc:"Lament can fake you out by going quiet and making it feel like the hunt ended (but it didn’t). It also doesn’t speed up from seeing you.",
    tips:["If it goes quiet but the door is still locked → suspicious.","Looping feels easier because it doesn’t ramp speed."]
  },
  {
    name:"Mare",
    evidence:["Freezing Temps","Spirit Box","SLS Anomaly"],
    cluesYes:["Turns off lights a lot","Blew out candles","Broke lights","High activity"],
    desc:"Mare hates light. It’s stronger in the dark, turns off lights a lot, and can blow out candles from farther away than normal.",
    tips:["If lights/candles keep getting bullied → Mare.","Keeping areas lit can reduce its danger (when possible)."]
  },
  {
    name:"Nook",
    evidence:["EMF Level 5","Freezing Temps","Ghost Orbs"],
    cluesYes:["Moves to room with most items","Items go missing","Moves room a lot"],
    desc:"Nook is item-obsessed and roams until it finds a room with lots of items. It can also steal/vanish objects.",
    tips:["Pile items and watch if stuff disappears.","If the ghost room keeps shifting with items → Nook vibes."]
  },
  {
    name:"Poltergeist",
    evidence:["Ultraviolet","Ghost Orbs","Spirit Box"],
    cluesYes:["High activity","Closes doors","Car alarm went off"],
    desc:"Poltergeist is a chaos ghost: constant interactions, doors, electronics, and general mess. It tends to keep activity high.",
    tips:["If the board stays busy nonstop → Poltergeist-ish.","Watch for lots of rapid interactions."]
  },
  {
    name:"Revenant",
    evidence:["EMF Level 5","Ultraviolet","Ghost Writing"],
    cluesYes:["Fast when it sees you"],
    desc:"Revenant is slow until it sees someone, then it becomes insanely fast. If you break line of sight, it drops speed quickly.",
    tips:["Listen: slow wandering → then sudden ‘oh no’ sprint.","Use corners/walls to break sight."]
  },
  {
    name:"Shade",
    evidence:["EMF Level 5","Ghost Writing","SLS Anomaly"],
    cluesYes:["Low activity"],
    cluesNo:["Saw ghost when at high sanity","High activity"],
    desc:"Shade is shy and quiet. It tends to do less and hunts later. If everything feels unusually calm, Shade becomes more likely.",
    tips:["If you’re deep in and it’s still quiet → Shade possibility.","Don’t expect flashy events."]
  },
  {
    name:"Spirit",
    evidence:["Ghost Writing","Ultraviolet","Spirit Box"],
    cluesYes:[],
    desc:"The ‘normal’ ghost. No huge gimmick — it behaves fairly standard. Strong reaction to incense (stun longer).",
    tips:["If nothing special stands out, Spirit stays in the running.","Use incense for safety/testing."]
  },
  {
    name:"Strigoi",
    evidence:["EMF Level 5","Ultraviolet","Ghost Orbs"],
    cluesYes:["Gets invisible near water","Turns on water","UV shows 4 fingers"],
    desc:"Strigoi loves water and can go extra invisible near it. It also has a unique UV print chance with 4 fingers.",
    tips:["If it’s super invisible near a running sink/pool → Strigoi.","Look for 4-finger UV prints."]
  },
  {
    name:"Vuult",
    evidence:["EMF Level 5","Ghost Orbs","SLS Anomaly"],
    cluesYes:["Broke lights","Turns off lights a lot","Turns on lights","High activity"],
    desc:"Vuult’s behavior revolves around electricity/charge. With more electronics/charge, it gets more dangerous and can hunt higher sanity.",
    tips:["If power/lighting behavior is WEIRD, Vuult is worth thinking about.","High activity + power messing feels Vuult-ish."]
  },
  {
    name:"Wraith",
    evidence:["Freezing Temps","Ghost Orbs","SLS Anomaly"],
    cluesNo:["Stepped in salt"],
    desc:"Wraith never steps in salt. If you see clear salt footprints, Wraith drops hard.",
    tips:["Salt footprints = Wraith unlikely.","If it roams and you never get salt steps, keep Wraith open."]
  },
  {
    name:"Yama",
    evidence:["Ghost Writing","Spirit Box","SLS Anomaly"],
    cluesYes:["Moves room a lot"],
    desc:"Yama roams and can change its favorite room multiple times. Stunning/cleansing can stop roaming briefly.",
    tips:["If the ghost room keeps changing for real → Yama or Nook.","Use incense to slow its roaming momentarily."]
  },
  {
    name:"Yurei",
    evidence:["Freezing Temps","Ultraviolet","Spirit Box"],
    cluesYes:["Blind during hunts (movement-based)"],
    desc:"Yurei is blind-ish during hunts and reacts to movement/electronics. Standing still can sometimes keep you safer.",
    tips:["Try standing still with electronics off during hunts (carefully).","If it seems to miss you, Yurei rises."]
  },
  {
    name:"ZoZo",
    evidence:["EMF Level 5","Ultraviolet","Spirit Box"],
    cluesYes:["Hunts at high sanity","High activity"],
    desc:"ZoZo is extremely dangerous and active. Spirit Board use can get messy with ZoZo’s interference and aggressive behavior.",
    tips:["If it’s aggressive early and constantly active → ZoZo/Demon zone.","Be careful using Spirit Board."]
  },
  {
    name:"Krasue",
    evidence:["Freezing Temps","EMF Level 5","Ultraviolet"],
    cluesYes:["Blew out candles"],
    desc:"Krasue can shift into a ‘head form’ and is slowed by flames. Candles/lighters can help slow it during hunts if conditions match.",
    tips:["Keep a lighter nearby for safety.","More flames can reduce its threat when it’s in head form."]
  }
];

/* ----------------------------
   UI STATE
---------------------------- */

const state = {
  evidence: Object.fromEntries(EVIDENCE.map(k=>[k,"unknown"])),
  clues: Object.fromEntries(CLUES.map(k=>[k,"unknown"])),
  house: HOUSES[0],
  difficulty: DIFFICULTIES[0].id,
  cursed: "none",
  tarot: "none"
};

// Special rule: “Stepped in salt” should NOT be allowed to be “No” (you asked to remove “didn’t step in salt”)
const NO_DISABLED_FOR = new Set(["Stepped in salt"]);

/* ----------------------------
   HELPERS
---------------------------- */

function cycleState(cur, key){
  // unknown -> yes -> no -> unknown
  if (NO_DISABLED_FOR.has(key)){
    // unknown -> yes -> unknown
    return cur === "unknown" ? "yes" : "unknown";
  }
  if(cur==="unknown") return "yes";
  if(cur==="yes") return "no";
  return "unknown";
}

function anySelected(){
  const ePicked = Object.values(state.evidence).some(v=>v!=="unknown");
  const cPicked = Object.values(state.clues).some(v=>v!=="unknown");
  const objPicked = state.cursed !== "none" || state.tarot !== "none";
  return ePicked || cPicked || objPicked;
}

function getWeights(){
  return DIFFICULTIES.find(d=>d.id===state.difficulty)?.weights || DIFFICULTIES[0].weights;
}

function scoreGhost(g){
  const w = getWeights();

  let score = 0;
  let maxPossible = 0;
  let contradictions = 0;

  // Evidence scoring (heavy)
  for(const ev of EVIDENCE){
    const pick = state.evidence[ev]; // yes/no/unknown
    if(pick==="unknown") continue;

    maxPossible += w.evidence;

    const has = g.evidence.includes(ev);
    if(pick==="yes"){
      if(has) score += w.evidence;
      else { score -= w.contradiction; contradictions++; }
    } else if(pick==="no"){
      if(!has) score += Math.round(w.evidence * 0.55);
      else { score -= w.contradiction; contradictions++; }
    }
  }

  // Clues scoring (medium)
  const yesList = g.cluesYes || [];
  const noList  = g.cluesNo || [];
  const maybeList = g.cluesMaybe || [];
  const isFreezingGhost = g.evidence.includes("Freezing Temps");

  for(const c of CLUES){
    const pick = state.clues[c];
    if(pick==="unknown") continue;

    maxPossible += w.clue;

    if(pick==="yes"){
      // soft boost: "Low temp room" gently favors freezing ghosts
      if(c==="Low temp room" && isFreezingGhost){
        score += Math.round(w.clue * 0.6);
      }
      if(yesList.includes(c)) score += w.clue;
      else if(maybeList.includes(c)) score += Math.round(w.clue * 0.55);
      else if(noList.includes(c)) { score -= w.contradiction; contradictions++; }
      else score += Math.round(w.clue * 0.12); // small “soft” signal
    } else if(pick==="no"){
      // If they said "No" to something the ghost is known for, that's a contradiction
      if(yesList.includes(c)) { score -= w.contradiction; contradictions++; }
      else score += Math.round(w.clue * 0.18);
    }
  }

  // Cursed object / tarot (very light)
  // (This is mostly informational, but we nudge a little where it makes sense)
  if(state.cursed==="spirit_board" && g.name==="ZoZo") score += 2;
  if(state.cursed==="summoning_circle" && g.name==="Shade") score += 1; // shades behave oddly here, but keep light
  if(state.cursed==="music_box" && g.name==="Demon") score += 1;

  // Normalize to 0..100-ish confidence later
  return { score, maxPossible, contradictions };
}

function computeRank(){
  const results = GHOSTS.map(g=>{
    const s = scoreGhost(g);
    return { ghost:g, ...s };
  });

  // If nothing selected, keep empty
  if(!anySelected()){
    return { ranked: results, best: null, confidence: 0 };
  }

  // Convert raw score to a stable 0-100
  // We use the best candidate as “100-ish” and scale others
  results.sort((a,b)=> b.score - a.score);

  const best = results[0];
  const bestScore = best.score;

  // If bestScore is negative, treat as 0 confidence
  const confidence = Math.max(0, Math.min(100, Math.round(
    best.maxPossible === 0 ? 0 : (best.score / (best.maxPossible)) * 100
  )));

  return { ranked: results, best, confidence };
}

function setTipChips(bestGhost){
  const tipsBar = document.getElementById("tipsBar");

  // keep your existing chips but add a couple dynamic ones
  const chips = [
    { text:`Tip: Salt footprints = yes → NOT Wraith` },
    { text:`Tip: Parabolic screech = yes → Banshee` },
    { text:`Tip: Water on + invisible → Strigoi` },
  ];

  if(bestGhost){
    if(bestGhost.name==="Mare") chips.unshift({ text:`Tip: Candles blown out + lights off a lot → Mare vibe` });
    if(bestGhost.name==="Vuult") chips.unshift({ text:`Tip: Power/lighting acting weird → Vuult vibe` });
    if(bestGhost.name==="ZoZo") chips.unshift({ text:`Tip: Super early hunts + high activity → ZoZo/Demon zone` });
    if(bestGhost.name==="Nook") chips.unshift({ text:`Tip: Items missing / room follows items → Nook` });
  }

  tipsBar.innerHTML = chips.slice(0,4).map(c=>`
    <div class="chip"><span class="glowdot"></span><span>${c.text}</span></div>
  `).join("");
}

function pillHTML(key, kind){
  const st = (kind==="evidence" ? state.evidence[key] : state.clues[key]) || "unknown";
  return `
    <div class="pill" data-kind="${kind}" data-key="${escapeHtml(key)}" data-state="${st}">
      <span class="dot"></span>
      <span>${escapeHtml(key)}</span>
    </div>
  `;
}

function escapeHtml(s){
  return String(s)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function setSelectOptions(sel, items, getLabel){
  sel.innerHTML = items.map(it=>{
    const v = typeof it === "string" ? it : it.id;
    const label = typeof it === "string" ? it : (getLabel ? getLabel(it) : it.name);
    return `<option value="${escapeHtml(v)}">${escapeHtml(label)}</option>`;
  }).join("");
}

function updateUI(){
  // Render pills
  document.getElementById("evidenceGrid").innerHTML = EVIDENCE.map(k=>pillHTML(k,"evidence")).join("");
  document.getElementById("clueGrid").innerHTML = CLUES.map(k=>pillHTML(k,"clue")).join("");

  // Compute
  const { ranked, best, confidence } = computeRank();

  // Top pick panel
  const emptyTop = document.getElementById("emptyTop");
  const topPick = document.getElementById("topPick");

  if(!best){
    emptyTop.style.display = "block";
    topPick.style.display = "none";
    document.getElementById("confidencePct").textContent = "0%";
    document.getElementById("confidenceBar").style.width = "0%";
    document.getElementById("countHint").textContent = "Pick something to rank ghosts";
    document.getElementById("rankList").innerHTML = `
      <div class="emptyState">No picks yet. Tap evidence/clues on the left.</div>
    `;
    setTipChips(null);
    return;
  }

  emptyTop.style.display = "none";
  topPick.style.display = "block";
  document.getElementById("topName").textContent = best.ghost.name;

  // Evidence tags
  const tagWrap = document.getElementById("topEvidenceTags");
  tagWrap.innerHTML = best.ghost.evidence.map(ev=>`<span class="tag"><strong>${escapeHtml(ev)}</strong></span>`).join("");

  // Description + tips
  const descBox = document.getElementById("topDescBox");
  const tipLines = (best.ghost.tips || []).map(t=>`• ${escapeHtml(t)}`).join("<br>");
  descBox.innerHTML = `
    <b>What it is:</b> ${escapeHtml(best.ghost.desc || "—")}<br><br>
    <b>Quick tips:</b><br>${tipLines || "—"}
  `;

  // Confidence
  document.getElementById("confidencePct").textContent = confidence + "%";
  document.getElementById("confidenceBar").style.width = confidence + "%";

  document.getElementById("countHint").textContent = `${ranked.length} ghosts ranked`;

  // Ranked list (top 8)
  const topN = ranked.slice(0,8);

  // Convert each candidate into a relative % next to best (feels nicer)
  const bestScore = topN[0].score || 1;

  document.getElementById("rankList").innerHTML = topN.map((r,i)=>{
    const relative = Math.max(0, Math.min(100, Math.round((r.score / bestScore) * 100)));
    const small = r.ghost.desc ? r.ghost.desc : "";
    const minis = [
      ...r.ghost.evidence.slice(0,3).map(x=>`<span class="miniTag">${escapeHtml(x)}</span>`),
      ...(r.contradictions>0 ? [`<span class="miniTag" style="border-color:rgba(255,94,106,.35);color:rgba(255,94,106,.95)">Contradictions: ${r.contradictions}</span>`] : [])
    ].join("");
    return `
      <div class="ghostRow">
        <div class="left">
          <p class="gname">${escapeHtml(r.ghost.name)}</p>
          <div class="small">${escapeHtml(small).slice(0,140)}${small.length>140 ? "…" : ""}</div>
          <div class="miniTags">${minis}</div>
        </div>
        <div class="scoreBox">
          <div class="pct">${relative}%</div>
          <div class="conf">${i===0 ? "Top match" : "Relative"}</div>
        </div>
      </div>
    `;
  }).join("");

  setTipChips(best.ghost);
}

/* ----------------------------
   Explain boxes
---------------------------- */

function explainCursed(){
  const box = document.getElementById("cursedExplainBox");
  const obj = CURSED_OBJECTS.find(x=>x.id===state.cursed) || CURSED_OBJECTS[0];
  box.classList.add("show");
  box.innerHTML = `<b>${escapeHtml(obj.name)}:</b> ${escapeHtml(obj.desc)}`;
}

function explainTarot(){
  const box = document.getElementById("tarotExplainBox");
  const t = TAROT.find(x=>x.id===state.tarot) || TAROT[0];
  box.classList.add("show");
  box.innerHTML = `<b>${escapeHtml(t.name)}:</b> ${escapeHtml(t.desc)}`;
}

/* ----------------------------
   Share link (so you can send to friends)
---------------------------- */

function encodeState(){
  const payload = {
    h: state.house,
    d: state.difficulty,
    e: state.evidence,
    c: state.clues,
    co: state.cursed,
    t: state.tarot
  };
  const json = JSON.stringify(payload);
  return btoa(unescape(encodeURIComponent(json)));
}

function decodeState(hash){
  try{
    const json = decodeURIComponent(escape(atob(hash)));
    const payload = JSON.parse(json);

    if(payload.h) state.house = payload.h;
    if(payload.d) state.difficulty = payload.d;

    if(payload.e){
      for(const k of Object.keys(state.evidence)){
        if(payload.e[k]) state.evidence[k] = payload.e[k];
      }
    }
    if(payload.c){
      for(const k of Object.keys(state.clues)){
        if(payload.c[k]) state.clues[k] = payload.c[k];
      }
    }
    if(payload.co) state.cursed = payload.co;
    if(payload.t) state.tarot = payload.t;

  }catch(e){}
}

/* ----------------------------
   Init
---------------------------- */

function init(){
  // Fill selects
  const houseSel = document.getElementById("houseSelect");
  setSelectOptions(houseSel, HOUSES);

  const diffSel = document.getElementById("difficultySelect");
  setSelectOptions(diffSel, DIFFICULTIES, d=>d.name);

  const cursedSel = document.getElementById("cursedSelect");
  setSelectOptions(cursedSel, CURSED_OBJECTS, o=>o.name);

  const tarotSel = document.getElementById("tarotSelect");
  setSelectOptions(tarotSel, TAROT, t=>t.name);

  // Load from URL hash if exists
  if(location.hash && location.hash.length>1){
    decodeState(location.hash.slice(1));
  }

  // Apply initial select values
  houseSel.value = state.house;
  diffSel.value = state.difficulty;
  cursedSel.value = state.cursed;
  tarotSel.value = state.tarot;

  // Listeners
  document.addEventListener("click", (e)=>{
    const pill = e.target.closest(".pill");
    if(!pill) return;

    const kind = pill.getAttribute("data-kind");
    const key = pill.getAttribute("data-key");

    if(kind==="evidence"){
      state.evidence[key] = cycleState(state.evidence[key], key);
    }else{
      state.clues[key] = cycleState(state.clues[key], key);
    }

    updateUI();
  });

  houseSel.addEventListener("change", ()=>{
    state.house = houseSel.value;
    updateUI();
  });
  diffSel.addEventListener("change", ()=>{
    state.difficulty = diffSel.value;
    updateUI();
  });
  cursedSel.addEventListener("change", ()=>{
    state.cursed = cursedSel.value;
    // hide explanation until they hit explain again (cleaner)
    document.getElementById("cursedExplainBox").classList.remove("show");
    updateUI();
  });
  tarotSel.addEventListener("change", ()=>{
    state.tarot = tarotSel.value;
    document.getElementById("tarotExplainBox").classList.remove("show");
    updateUI();
  });

  document.getElementById("cursedExplainBtn").addEventListener("click", explainCursed);
  document.getElementById("tarotExplainBtn").addEventListener("click", explainTarot);

  document.getElementById("resetBtn").addEventListener("click", ()=>{
    for(const k of Object.keys(state.evidence)) state.evidence[k] = "unknown";
    for(const k of Object.keys(state.clues)) state.clues[k] = "unknown";
    state.cursed = "none";
    state.tarot = "none";
    document.getElementById("cursedSelect").value = "none";
    document.getElementById("tarotSelect").value = "none";
    document.getElementById("cursedExplainBox").classList.remove("show");
    document.getElementById("tarotExplainBox").classList.remove("show");
    location.hash = "";
    updateUI();
  });

  document.getElementById("copyBtn").addEventListener("click", async ()=>{
    const hash = encodeState();
    const url = location.origin + location.pathname + "#" + hash;
    try{
      await navigator.clipboard.writeText(url);
      alert("Copied share link!");
    }catch(e){
      prompt("Copy this link:", url);
    }
  });

  // First paint
  updateUI();
}

init();
</script>
</body>
</html>
